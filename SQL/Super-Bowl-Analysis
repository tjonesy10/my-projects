#!/usr/bin/env python
# coding: utf-8

# ## 1. TV, halftime shows, and the Big Game
# <p>Whether or not you like football, the Super Bowl is a spectacle. There's a little something for everyone at your Super Bowl party. Drama in the form of blowouts, comebacks, and controversy for the sports fan. There are the ridiculously expensive ads, some hilarious, others gut-wrenching, thought-provoking, and weird. The half-time shows with the biggest musicians in the world, sometimes <a href="https://youtu.be/ZD1QrIe--_Y?t=14">riding giant mechanical tigers</a> or <a href="https://youtu.be/mjrdywp5nyE?t=62">leaping from the roof of the stadium</a>. It's a show, baby. And in this notebook, we're going to find out how some of the elements of this show interact with each other. After exploring and cleaning our data a little, we're going to answer questions like:</p>
# <ul>
# <li>What are the most extreme game outcomes?</li>
# <li>How does the game affect television viewership?</li>
# <li>How have viewership, TV ratings, and ad cost evolved over time?</li>
# <li>Who are the most prolific musicians in terms of halftime show performances?</li>
# </ul>
# <p><img src="https://assets.datacamp.com/production/project_731/img/left_shark.jpg" alt="Left Shark Steals The Show">
# <em><a href="https://www.flickr.com/photos/huntleypaton/16464994135/in/photostream/">Left Shark Steals The Show</a>. Katy Perry performing at halftime of Super Bowl XLIX. Photo by Huntley Paton. Attribution-ShareAlike 2.0 Generic (CC BY-SA 2.0).</em></p>
# <p>The database we'll use is named <code>super_bowls</code>. It was <a href="https://en.wikipedia.org/wiki/Web_scraping">scraped</a> and polished from Wikipedia and is made up of three tables, one with <a href="https://en.wikipedia.org/wiki/List_of_Super_Bowl_champions">game data</a>, one with <a href="https://en.wikipedia.org/wiki/Super_Bowl_television_ratings">TV broadcast data</a>, and one with <a href="https://en.wikipedia.org/wiki/List_of_Super_Bowl_halftime_shows">halftime musician performance data</a> for all 52 Super Bowls through 2018. Let's take a look at the game data, which is stored in the <code>games</code> table.</p>

# In[311]:


get_ipython().run_cell_magic('sql', '', 'postgresql:///super_bowls\nSELECT *\nFROM games\nORDER BY super_bowl DESC\nLIMIT 5;')


# In[312]:


get_ipython().run_cell_magic('nose', '', '# %%nose needs to be included at the beginning of every @tests cell\n\nlast_output = _\n\ndef test_output():\n    correct_result_string = "   super_bowl   date_game                          venue             city       state  attendance           team_winner  winning_pts     qb_winner_1 qb_winner_2    coach_winner            team_loser  losing_pts      qb_loser_1 qb_loser_2     coach_loser  combined_pts  difference_pts\\n0          52  2018-02-04              U.S. Bank Stadium      Minneapolis   Minnesota       67612   Philadelphia Eagles           41      Nick Foles        None   Doug Pederson  New England Patriots          33       Tom Brady       None  Bill Belichick            74               8\\n1          51  2017-02-05                    NRG Stadium          Houston       Texas       70807  New England Patriots           34       Tom Brady        None  Bill Belichick       Atlanta Falcons          28       Matt Ryan       None       Dan Quinn            62               6\\n2          50  2016-02-07                 Levi\'s Stadium      Santa Clara  California       71088        Denver Broncos           24  Peyton Manning        None     Gary Kubiak     Carolina Panthers          10      Cam Newton       None      Ron Rivera            34              14\\n3          49  2015-02-01  University of Phoenix Stadium         Glendale     Arizona       70288  New England Patriots           28       Tom Brady        None  Bill Belichick      Seattle Seahawks          24  Russell Wilson       None    Pete Carroll            52               4\\n4          48  2014-02-02                MetLife Stadium  East Rutherford  New Jersey       82529      Seattle Seahawks           43  Russell Wilson        None    Pete Carroll        Denver Broncos           8  Peyton Manning       None        John Fox            51              35"\n    try:\n        assert last_output.DataFrame().to_string() == correct_result_string\n    except AttributeError:\n        assert False, "Please ensure a SQL ResultSet is the output of the code cell."\n    except AssertionError:\n        assert False, "The results of the query are incorrect. Please review the instructions and check the hint if necessary."')


# ## 2. Data issues in the broadcasts table
# <p>For the Super Bowl game data, we can see the dataset appears whole except for missing values in the backup quarterback columns (<code>qb_winner_2</code> and <code>qb_loser_2</code>), which make sense given most starting QBs in the Super Bowl (<code>qb_winner_1</code> and <code>qb_loser_1</code>) play the entire game.</p>
# <p>Let's take a look at the TV broadcast data, which is stored in the <code>broadcasts</code> table.</p>

# In[313]:


get_ipython().run_cell_magic('sql', '', 'select *\nfrom broadcasts\nlimit 10;')


# In[314]:


get_ipython().run_cell_magic('nose', '', '# %%nose needs to be included at the beginning of every @tests cell\n\nlast_output = _\n\ndef test_output():\n    correct_result_string = \'   broadcast_id  super_bowl network  avg_us_viewers  total_us_viewers  rating_household  share_household rating_18_49 share_18_49  ad_cost\\n0             1           1     NBC        24430000               NaN              18.5               36         None        None    37500\\n1             2           1     CBS        26750000        51180000.0              22.6               43         None        None    42500\\n2             3           2     CBS        39120000               NaN              36.8               68         None        None    54500\\n3             4           3     NBC        41660000               NaN              36.0               70         None        None    55000\\n4             5           4     CBS        44270000               NaN              39.4               69         None        None    78200\\n5             6           5     NBC        46040000               NaN              39.9               75         None        None    72500\\n6             7           6     CBS        56640000               NaN              44.2               74         None        None    86100\\n7             8           7     NBC        53320000               NaN              42.7               72         None        None    88100\\n8             9           8     CBS        51700000               NaN              41.6               73         None        None   103500\\n9            10           9     NBC        56050000               NaN              42.4               72         None        None   107000\'\n    try:\n        assert last_output.DataFrame().to_string() == correct_result_string\n    except AttributeError:\n        assert False, "Please ensure a SQL ResultSet is the output of the code cell."\n    except AssertionError:\n        assert False, "The results of the query are incorrect. Please review the instructions and check the hint if necessary."')


# ## 3. Data issues in the performances table
# <p>For the TV data, the following columns have missing values and a lot of them:</p>
# <ul>
# <li><code>total_us_viewers</code> (amount of U.S. viewers who watched at least some part of the broadcast)</li>
# <li><code>rating_18_49</code> (average % of U.S. adults 18-49 who live in a household with a TV that were watching for the entire broadcast)</li>
# <li><code>share_18_49</code> (average % of U.S. adults 18-49 who live in a household with a TV <em>in use</em> that were watching for the entire broadcast)</li>
# </ul>
# <p>Let's check out the halftime musician performance data (stored in the <code>performances</code> table). We'll look at one </p>

# In[315]:


get_ipython().run_cell_magic('sql', '', 'SELECT *\nFROM performances\nWHERE num_songs IS NULL\nORDER BY super_bowl DESC;')


# In[316]:


get_ipython().run_cell_magic('nose', '', '# %%nose needs to be included at the beginning of every @tests cell\n\nlast_output = _\n\ndef test_output():\n    correct_result_string = "    performance_id  super_bowl                                           musician num_songs\\n0              121          49   Arizona State University Sun Devil Marching Band      None\\n1              100          41           Florida A&M University Marching 100 Band      None\\n2               91          38                    The Ocean of Soul Marching Band      None\\n3               90          38         The Spirit of Houston Cougar Marching Band      None\\n4               53          26              University of Minnesota Marching Band      None\\n5               46          24                                  The Human Jukebox      None\\n6               47          24                    Pride of Nicholls Marching Band      None\\n7               45          24                                  Pride of Acadiana      None\\n8               42          22         San Diego State University Marching Aztecs      None\\n9               41          22                                     Spirit of Troy      None\\n10              38          20                                     Up with People      None\\n11              37          19                                       Tops In Blue      None\\n12              34          17  Los Angeles Unified School District All City H...      None\\n13              33          16                                     Up with People      None\\n14              32          15                                  The Human Jukebox      None\\n15              31          15                                    Helen O\'Connell      None\\n16              30          14                                     Up with People      None\\n17              29          14     Grambling State University Tiger Marching Band      None\\n18              28          13                                       Ken Hamilton      None\\n19              27          13                                           Gramacks      None\\n20              24          12                                            Al Hirt      None\\n21              25          12                                      Pete Fountain      None\\n22              26          12                   Tyler Junior College Apache Band      None\\n23              23          11  Los Angeles Unified School District All City H...      None\\n24              22          10                                     Up with People      None\\n25              21           9     Grambling State University Tiger Marching Band      None\\n26              20           9                                   Mercer Ellington      None\\n27              18           8                  University of Texas Longhorn Band      None\\n28              19           8                                       Judy Mallett      None\\n29              16           7                                       Woody Herman      None\\n30              17           7               University of Michigan Marching Band      None\\n31              15           7                                      Andy Williams      None\\n32              13           6                                     Carol Channing      None\\n33              14           6                                    Ella Fitzgerald      None\\n34              12           6                                            Al Hirt      None\\n35              11           6      United States Air Force Academy Cadet Chorale      None\\n36              10           5             Southeast Missouri State Marching Band      None\\n37               9           4                                  Marguerite Piazza      None\\n38               8           4                                     Doc Severinsen      None\\n39               7           4                                            Al Hirt      None\\n40               6           4                                  The Human Jukebox      None\\n41               5           3           Florida A&M University Marching 100 Band      None\\n42               4           2     Grambling State University Tiger Marching Band      None\\n43               2           1     Grambling State University Tiger Marching Band      None\\n44               1           1                                            Al Hirt      None\\n45               3           1      University of Arizona Symphonic Marching Band      None"\n    try:\n        assert last_output.DataFrame().to_string() == correct_result_string\n    except AttributeError:\n        assert False, "Please ensure a SQL ResultSet is the output of the code cell."\n    except AssertionError:\n        assert False, "The results of the query are incorrect. Please review the instructions and check the hint if necessary."')


# ## 4. The highest- and lowest-scoring Super Bowls
# <p>We have missing numbers of songs performed (<code>num_songs</code>) for about a third of the performances, most of them for earlier Super Bowls.</p>
# <p>Why all of these missing values in the <code>broadcasts</code> and <code>performances</code> tables? Was the data ever tracked? Was it lost in history? Is this a Wikipedia issue? There are a lot of potential reasons. Is the research effort to make this data whole worth it? Maybe. Watching every Super Bowl halftime show to get song counts would be pretty fun. But we don't have the time to do that kind of stuff now! Let's take note of where the dataset isn't perfect and start uncovering some insights.</p>
# <p>Let's start by looking at combined points for each Super Bowl by pinpointing the Super Bowls with the highest and lowest scores.</p>

# In[317]:


get_ipython().run_cell_magic('sql', '', 'SELECT *\nFROM games\nWHERE combined_pts > 70 OR combined_pts < 25;')


# In[318]:


get_ipython().run_cell_magic('nose', '', '# %%nose needs to be included at the beginning of every @tests cell\n\nlast_output = _\n\ndef test_output():\n    correct_result_string = \'   super_bowl   date_game               venue           city       state  attendance          team_winner  winning_pts     qb_winner_1 qb_winner_2    coach_winner            team_loser  losing_pts      qb_loser_1     qb_loser_2     coach_loser  combined_pts  difference_pts\\n0           3  1969-01-12         Orange Bowl          Miami     Florida       75389        New York Jets           16      Joe Namath        None     Weeb Ewbank       Baltimore Colts           7    Earl Morrall  Johnny Unitas       Don Shula            23               9\\n1           7  1973-01-14   Memorial Coliseum    Los Angeles  California       90182       Miami Dolphins           14      Bob Griese        None       Don Shula   Washington Redskins           7     Bill Kilmer           None    George Allen            21               7\\n2           9  1975-01-12      Tulane Stadium    New Orleans   Louisiana       80997  Pittsburgh Steelers           16  Terry Bradshaw        None      Chuck Noll     Minnesota Vikings           6  Fran Tarkenton           None       Bud Grant            22              10\\n3          29  1995-01-29  Joe Robbie Stadium  Miami Gardens     Florida       74107  San Francisco 49ers           49     Steve Young        None  George Seifert    San Diego Chargers          26  Stan Humphreys           None      Bobby Ross            75              23\\n4          52  2018-02-04   U.S. Bank Stadium    Minneapolis   Minnesota       67612  Philadelphia Eagles           41      Nick Foles        None   Doug Pederson  New England Patriots          33       Tom Brady           None  Bill Belichick            74               8\'\n    try:\n        assert last_output.DataFrame().to_string() == correct_result_string\n    except AttributeError:\n        assert False, "Please ensure a SQL ResultSet is the output of the code cell."\n    except AssertionError:\n        assert False, "The results of the query are incorrect. Please review the instructions and check the hint if necessary."')


# ## 5. The blowouts and nailbiters
# <p>The highest combined scores at 74 and 75, we find two games featuring dominant quarterback performances. One even happened recently in 2018's Super Bowl LII where Tom Brady's Patriots lost to Nick Foles' underdog Eagles 41-33 for a combined score of 74.</p>
# <p>Going down to the lowest combined scores, we have Super Bowl III and VII, which featured tough defenses that dominated. We also have Super Bowl IX in New Orleans in 1975, whose 16-6 score can be attributed to inclement weather. The field was slick from overnight rain, and it was cold at 46 °F (8 °C), making it hard for the Steelers and Vikings to do much offensively. This was the second-coldest Super Bowl ever and the last to be played in inclement weather for over 30 years. The NFL realized people like points, I guess.</p>
# <p><em>UPDATE: In Super Bowl LIII in 2019, the Patriots and Rams broke the record for the lowest-scoring Super Bowl with a combined score of 16 points (13-3 for the Patriots).</em></p>
# <p>Let's take a look at point <em>difference</em> now.</p>

# In[319]:


get_ipython().run_cell_magic('sql', '', 'SELECT *\nFROM games\nWHERE difference_pts = 1 OR difference_pts >= 35;')


# In[320]:


get_ipython().run_cell_magic('nose', '', '# %%nose needs to be included at the beginning of every @tests cell\n\nlast_output = _\n\ndef test_output():\n    correct_result_string = \'   super_bowl   date_game                venue             city       state  attendance          team_winner  winning_pts     qb_winner_1 qb_winner_2    coach_winner            team_loser  losing_pts      qb_loser_1    qb_loser_2    coach_loser  combined_pts  difference_pts\\n0          20  1986-01-26  Louisiana Superdome      New Orleans   Louisiana       73818        Chicago Bears           46     Jim McMahon        None      Mike Ditka  New England Patriots          10      Tony Eason  Steve Grogan  Raymond Berry            56              36\\n1          24  1990-01-28  Louisiana Superdome      New Orleans   Louisiana       72919  San Francisco 49ers           55     Joe Montana        None  George Seifert        Denver Broncos          10      John Elway          None     Dan Reeves            65              45\\n2          25  1991-01-27        Tampa Stadium            Tampa     Florida       73813      New York Giants           20  Jeff Hostetler        None   Bill Parcells         Buffalo Bills          19       Jim Kelly          None      Marv Levy            39               1\\n3          27  1993-01-31            Rose Bowl         Pasadena  California       98374       Dallas Cowboys           52     Troy Aikman        None   Jimmy Johnson         Buffalo Bills          17       Jim Kelly   Frank Reich      Marv Levy            69              35\\n4          48  2014-02-02      MetLife Stadium  East Rutherford  New Jersey       82529     Seattle Seahawks           43  Russell Wilson        None    Pete Carroll        Denver Broncos           8  Peyton Manning          None       John Fox            51              35\'\n    try:\n        assert last_output.DataFrame().to_string() == correct_result_string\n    except AttributeError:\n        assert False, "Please ensure a SQL ResultSet is the output of the code cell."\n    except AssertionError:\n        assert False, "The results of the query are incorrect. Please review the instructions and check the hint if necessary."')


# ## 6. Do blowouts translate to lost viewers?
# <p>The closest game ever was when the Buffalo Bills lost to the New York Giants by 1 point in 1991, which was  best remembered for Scott Norwood's last-second missed field goal attempt that went <em><a href="https://www.youtube.com/watch?v=RPFZCGgjDSg">wide right</a></em>, kicking off four Bills Super Bowl losses in a row. Poor Scott. The biggest point discrepancy ever was 45 points (!) where Hall of Famer Joe Montana's led the San Francisco 49ers to victory in 1990, one year before the closest game ever.</p>
# <p>I remember watching the Seahawks crush the Broncos by 35 points (43-8) in 2014, which was a boring experience in my opinion. The game was never really close. I'm pretty sure we changed the channel at the end of the third quarter. Let's combine our game data and TV data to see if this is a universal phenomenon. Do large point differences translate to lost viewers? Let's compare <a href="https://en.wikipedia.org/wiki/Nielsen_ratings">household share</a> <em>(average percentage of U.S. households with a TV in use that were watching for the entire broadcast)</em> for "blowouts" (games where the point difference is three touchdowns, i.e., 21 points,  or more) vs. non-blowouts.</p>

# In[321]:


get_ipython().run_cell_magic('sql', '', 'SELECT blowout,\n       AVG(difference_pts) as avg_difference_pts,\n       AVG(share_household) as avg_share_household\nFROM\n    (SELECT games.super_bowl, difference_pts, share_household,\n        CASE WHEN difference_pts >= 21 THEN TRUE\n        ELSE FALSE END\n        AS blowout\n    FROM games\n    INNER JOIN broadcasts\n    ON games.super_bowl = broadcasts.super_bowl) AS subquery\nGROUP BY blowout;\n ')


# In[322]:


get_ipython().run_cell_magic('nose', '', '# %%nose needs to be included at the beginning of every @tests cell\n\nlast_output = _\n\ndef test_output():\n    correct_result_string = \'   blowout   avg_difference_pts  avg_share_household\\n0    False   9.3250000000000000  67.8250000000000000\\n1     True  29.3846153846153846  61.9230769230769231\'\n    try:\n        assert last_output.DataFrame().to_string() == correct_result_string\n    except AttributeError:\n        assert False, "Please ensure a SQL ResultSet is the output of the code cell."\n    except AssertionError:\n        assert False, "The results of the query are incorrect. Please review the instructions and check the hint if necessary."')


# ## 7. Viewership and the ad industry over time
# <p>We see a 6-point difference in average household share for blowouts vs. non-blowouts! Though it matches our intuition, we must take it with a grain of salt due to our small sample size of 52 games.</p>
# <p>Regardless of the score though, I bet most people stick it out for the halftime show, which is good news for the TV networks and advertisers. A 30-second spot costs a pretty <a href="https://www.businessinsider.com/super-bowl-commercials-cost-more-than-eagles-quarterback-earns-2018-1">\$5 million</a> now, but has it always been that way? And how have number of viewers and household ratings trended alongside ad cost? Let's take a look at this data in six different decades.</p>

# In[323]:


get_ipython().run_cell_magic('sql', '', 'SELECT super_bowl,\n       avg_us_viewers,\n        rating_household,\n        ad_cost\nFROM broadcasts\nWHERE super_bowl IN (2, 12, 22, 32, 42, 52);')


# In[324]:


get_ipython().run_cell_magic('nose', '', '# %%nose needs to be included at the beginning of every @tests cell\n\nlast_output = _\n\ndef test_output():\n    correct_result_string = \'   super_bowl  avg_us_viewers  rating_household  ad_cost\\n0           2        39120000              36.8    54500\\n1          12        78940000              47.2   162300\\n2          22        80140000              41.9   645000\\n3          32        90000000              44.5  1291100\\n4          42        97448000              43.1  2699963\\n5          52       103390000              43.1  5000000\'\n    try:\n        assert last_output.DataFrame().to_string() == correct_result_string\n    except AttributeError:\n        assert False, "Please ensure a SQL ResultSet is the output of the code cell."\n    except AssertionError:\n        assert False, "The results of the query are incorrect. Please review the instructions and check the hint if necessary."')


# ## 8. Halftime shows weren't always this great
# <p>We can see viewers increased before ad costs did. <code>avg_us_viewers</code> was 90 million in 1998 (Super Bowl XXXII) and an ad cost \$1.29 million. That is an <a href="https://westegg.com/inflation/">inflation-adjusted</a> \$2.02 million in 2018, where <code>avg_us_viewers</code> was actually 103 million and <code>ad_cost</code> was \$5 million. Maybe the networks weren't very data savvy and were slow to react. (It'd make sense since DataCamp didn't exist back then!)</p>
# <p>Another hypothesis: maybe halftime shows weren't that good in the earlier years? The modern spectacle of the Super Bowl has a lot to do with the cultural prestige of big halftime acts. I went down a YouTube rabbit hole and it turns out the old ones weren't up to today's standards. Some offenders:</p>
# <ul>
# <li><a href="https://youtu.be/6wMXHxWO4ns?t=263">Super Bowl XXVI</a> in 1992: A Frosty The Snowman rap performed by children.</li>
# <li><a href="https://www.youtube.com/watch?v=PKQTL1PYSag">Super Bowl XXIII</a> in 1989: An Elvis impersonator that did magic tricks and didn't even sing one Elvis song.</li>
# <li><a href="https://youtu.be/oSXMNbK2e98?t=436">Super Bowl XXI</a> in 1987: Tap dancing ponies. (Okay, that's pretty awesome actually.)</li>
# </ul>
# <p>It turns out Michael Jackson's Super Bowl XXVII performance, one of the most watched events in American TV history, was when the NFL realized the value of Super Bowl airtime and decided they needed to sign big name acts from then on out. The halftime shows before MJ indeed weren't that impressive, which we can see by filtering our <code>performances</code> table.</p>

# In[325]:


get_ipython().run_cell_magic('sql', '', "SELECT *\nFROM performances\nWHERE super_bowl <= \n    (SELECT super_bowl\n     FROM performances\n     WHERE musician = 'Michael Jackson')\nORDER BY super_bowl DESC;")


# In[326]:


get_ipython().run_cell_magic('nose', '', '# %%nose needs to be included at the beginning of every @tests cell\n\nlast_output = _\n\ndef test_output():\n    correct_result_string = "    performance_id  super_bowl                                           musician  num_songs\\n0               54          27                                    Michael Jackson        5.0\\n1               53          26              University of Minnesota Marching Band        NaN\\n2               52          26                                     Gloria Estefan        2.0\\n3               51          25                              New Kids on the Block        2.0\\n4               47          24                    Pride of Nicholls Marching Band        NaN\\n5               46          24                                  The Human Jukebox        NaN\\n6               45          24                                  Pride of Acadiana        NaN\\n7               50          24                                      Pete Fountain        1.0\\n8               49          24                                       Doug Kershaw        1.0\\n9               48          24                                        Irma Thomas        1.0\\n10              44          23                                       Elvis Presto        7.0\\n11              42          22         San Diego State University Marching Aztecs        NaN\\n12              43          22                                     Chubby Checker        2.0\\n13              41          22                                     Spirit of Troy        NaN\\n14              40          21     Grambling State University Tiger Marching Band        8.0\\n15              39          21                                     Spirit of Troy        8.0\\n16              38          20                                     Up with People        NaN\\n17              37          19                                       Tops In Blue        NaN\\n18              35          18  The University of Florida Fightin\' Gator March...        7.0\\n19              36          18       The Florida State University Marching Chiefs        7.0\\n20              34          17  Los Angeles Unified School District All City H...        NaN\\n21              33          16                                     Up with People        NaN\\n22              32          15                                  The Human Jukebox        NaN\\n23              31          15                                    Helen O\'Connell        NaN\\n24              29          14     Grambling State University Tiger Marching Band        NaN\\n25              30          14                                     Up with People        NaN\\n26              28          13                                       Ken Hamilton        NaN\\n27              27          13                                           Gramacks        NaN\\n28              24          12                                            Al Hirt        NaN\\n29              26          12                   Tyler Junior College Apache Band        NaN\\n30              25          12                                      Pete Fountain        NaN\\n31              23          11  Los Angeles Unified School District All City H...        NaN\\n32              22          10                                     Up with People        NaN\\n33              20           9                                   Mercer Ellington        NaN\\n34              21           9     Grambling State University Tiger Marching Band        NaN\\n35              19           8                                       Judy Mallett        NaN\\n36              18           8                  University of Texas Longhorn Band        NaN\\n37              16           7                                       Woody Herman        NaN\\n38              17           7               University of Michigan Marching Band        NaN\\n39              15           7                                      Andy Williams        NaN\\n40              11           6      United States Air Force Academy Cadet Chorale        NaN\\n41              14           6                                    Ella Fitzgerald        NaN\\n42              13           6                                     Carol Channing        NaN\\n43              12           6                                            Al Hirt        NaN\\n44              10           5             Southeast Missouri State Marching Band        NaN\\n45               7           4                                            Al Hirt        NaN\\n46               9           4                                  Marguerite Piazza        NaN\\n47               8           4                                     Doc Severinsen        NaN\\n48               6           4                                  The Human Jukebox        NaN\\n49               5           3           Florida A&M University Marching 100 Band        NaN\\n50               4           2     Grambling State University Tiger Marching Band        NaN\\n51               2           1     Grambling State University Tiger Marching Band        NaN\\n52               3           1      University of Arizona Symphonic Marching Band        NaN\\n53               1           1                                            Al Hirt        NaN"\n    try:\n        assert last_output.DataFrame().to_string() == correct_result_string\n    except AttributeError:\n        assert False, "Please ensure a SQL ResultSet is the output of the code cell."\n    except AssertionError:\n        assert False, "The results of the query are incorrect. Please review the instructions and check the hint if necessary."')


# ## 9. Who has the most halftime show appearances?
# <p>Lots of marching bands. American jazz clarinetist Pete Fountain. Miss Texas 1973 playing a violin. Nothing against those performers, they're just simply not <a href="https://www.youtube.com/watch?v=suIg9kTGBVI">Beyoncé</a>. To be fair, no one is.</p>
# <p>Let's see all of the musicians that have done at least one halftime show, including their performance counts.</p>

# In[327]:


get_ipython().run_cell_magic('sql', '', 'SELECT musician, COUNT(*) as count_performances\nFROM performances\nGROUP BY musician\nHAVING COUNT(*) > 1\nORDER BY count_performances DESC, musician ASC;')


# In[328]:


get_ipython().run_cell_magic('nose', '', '# %%nose needs to be included at the beginning of every @tests cell\n\nlast_output = _\n\ndef test_output():\n    correct_result_string = \'                                             musician  count_performances\\n0      Grambling State University Tiger Marching Band                   6\\n1                                             Al Hirt                   4\\n2                                      Up with People                   4\\n3                                   The Human Jukebox                   3\\n4                                             Beyoncé                   2\\n5                                          Bruno Mars                   2\\n6            Florida A&M University Marching 100 Band                   2\\n7                                      Gloria Estefan                   2\\n8                                   Justin Timberlake                   2\\n9   Los Angeles Unified School District All City H...                   2\\n10                                              Nelly                   2\\n11                                      Pete Fountain                   2\\n12                                     Spirit of Troy                   2\\n13              University of Minnesota Marching Band                   2\'\n    try:\n        assert last_output.DataFrame().to_string() == correct_result_string\n    except AttributeError:\n        assert False, "Please ensure a SQL ResultSet is the output of the code cell."\n    except AssertionError:\n        assert False, "The results of the query are incorrect. Please review the instructions and check the hint if necessary."')


# ## 10. Who performed the most songs in a halftime show?
# <p>The world famous <a href="https://www.youtube.com/watch?v=RL_3oqpHiDg">Grambling State University Tiger Marching Band</a> takes the crown with six appearances. Beyoncé, Justin Timberlake, Nelly, and Bruno Mars are the only post-Y2K musicians with multiple appearances (two each).</p>
# <p>From our previous inspections, the <code>num_songs</code> column has lots of missing values:</p>
# <ul>
# <li>A lot of the marching bands don't have <code>num_songs</code> entries.</li>
# <li>For non-marching bands, missing data starts occurring at Super Bowl XX.</li>
# </ul>
# <p>We can filter out <em>most</em> marching bands by filtering out musicians with the word "Marching" and the word "Spirit" in them (a common naming convention for marching bands is "Spirit of [something]"). Then we'll filter for Super Bowls after Super Bowl XX to address the missing data issue, <em>then</em> let's see who has the most number of songs.</p>

# In[329]:


get_ipython().run_cell_magic('sql', '', "SELECT *\nFROM performances\nWHERE musician NOT LIKE '%Marching%'\nAND musician NOT LIKE '%Spirit%'\nAND num_songs IS NOT NULL\nORDER BY num_songs DESC;")


# In[330]:


get_ipython().run_cell_magic('nose', '', '# %%nose needs to be included at the beginning of every @tests cell\n\nlast_output = _\n\ndef test_output():\n    correct_result_string = "    performance_id  super_bowl                                 musician  num_songs\\n0              134          52                        Justin Timberlake         11\\n1               64          30                               Diana Ross         10\\n2              124          49                               Katy Perry          8\\n3              118          47                                  Beyoncé          7\\n4               44          23                             Elvis Presto          7\\n5              101          41                                   Prince          7\\n6              132          51                                Lady Gaga          7\\n7              131          50                                 Coldplay          6\\n8              120          48                               Bruno Mars          6\\n9              109          45                      The Black Eyed Peas          6\\n10              54          27                          Michael Jackson          5\\n11             104          44                                  The Who          5\\n12             114          46                                  Madonna          5\\n13              75          33                            Stevie Wonder          4\\n14              69          32                          The Temptations          4\\n15              98          39                           Paul McCartney          4\\n16             103          43  Bruce Springsteen and the E Street Band          4\\n17             102          42            Tom Petty & the Heartbreakers          4\\n18              65          31                              James Brown          3\\n19              85          35                                Aerosmith          3\\n20              86          36                                       U2          3\\n21             129          50                               Bruno Mars          3\\n22              95          38                                 P. Diddy          3\\n23              96          38                            Janet Jackson          3\\n24              99          40                       The Rolling Stones          3\\n25              63          29                            Patti Labelle          3\\n26              84          35                                    NSYNC          3\\n27              66          31                                   ZZ Top          3\\n28              67          31                       The Blues Brothers          3\\n29              70          32                              Boyz II Men          3\\n30             130          50                                  Beyoncé          3\\n31              73          32                          Smokey Robinson          3\\n32             126          50              Youth Orchestra Los Angeles          3\\n33              76          33                           Gloria Estefan          3\\n34             125          50                          Gustavo Dudamel          3\\n35             122          49                            Missy Elliott          3\\n36              88          37                             Shania Twain          2\\n37              51          25                    New Kids on the Block          2\\n38              52          26                           Gloria Estefan          2\\n39              55          28                             Wynonna Judd          2\\n40              57          28                             Travis Tritt          2\\n41              58          28                             Tanya Tucker          2\\n42              59          28                              Clint Black          2\\n43              61          29                          Arturo Sandoval          2\\n44              62          29                             Tony Bennett          2\\n45              71          32                            Queen Latifah          2\\n46              72          32                            Martha Reeves          2\\n47              87          37                                 No Doubt          2\\n48              43          22                           Chubby Checker          2\\n49              93          38                                 Kid Rock          2\\n50             110          46                             Cee Lo Green          2\\n51             117          47                          Destiny\'s Child          2\\n52              92          38                        Justin Timberlake          1\\n53              89          37                                    Sting          1\\n54             105          45                                   Fergie          1\\n55             106          45                                will.i.am          1\\n56             107          45                                    Usher          1\\n57             108          45                                    Slash          1\\n58              83          35                           Britney Spears          1\\n59              49          24                             Doug Kershaw          1\\n60             111          46                                   M.I.A.          1\\n61             112          46                              Nicki Minaj          1\\n62             113          46                                    LMFAO          1\\n63              82          35                            Mary J. Blige          1\\n64             115          47                        Michelle Williams          1\\n65             116          47                            Kelly Rowland          1\\n66              48          24                              Irma Thomas          1\\n67              81          35                                    Nelly          1\\n68             119          48                    Red Hot Chili Peppers          1\\n69              80          34                             Phil Collins          1\\n70              79          34                       Christina Aguilera          1\\n71             123          49                            Lenny Kravitz          1\\n72              78          34                         Enrique Iglesias          1\\n73              77          34                             Toni Braxton          1\\n74              74          33                     Big Bad Voodoo Daddy          1\\n75             128          50                              Mark Ronson          1\\n76              60          29                      Miami Sound Machine          1\\n77              56          28                                The Judds          1\\n78              50          24                            Pete Fountain          1\\n79              97          38                          Jessica Simpson          1\\n80              94          38                                    Nelly          1"\n    try:\n        assert last_output.DataFrame().to_string() == correct_result_string\n    except AttributeError:\n        assert False, "Please ensure a SQL ResultSet is the output of the code cell."\n    except AssertionError:\n        assert False, "The results of the query are incorrect. Please review the instructions and check the hint if necessary."')


# ## 11. Conclusion
# <p>So most non-band musicians do 1-3 songs per halftime show. It's important to note that the duration of the halftime show is fixed (roughly 12 minutes) so songs per performance is more a measure of how many hit songs you have. JT went off in 2018, wow. 11 songs! Diana Ross comes in second with 10 in her medley in 1996.</p>
# <p>In this notebook, we loaded, cleaned, then explored Super Bowl game, television, and halftime show data. We visualized the distributions of combined points, point differences, and halftime show performances using histograms. We used line plots to see how ad cost increases lagged behind viewership increases. And we discovered that blowouts do appear to lead to a drop in viewers.</p>
# <p>This year's Big Game features the Rams and the Patriots, and these two teams have actually met before in a previous Super Bowl. Who will win this time? Will the score be similar?</p>
# <p><em>UPDATE: <a href="https://en.wikipedia.org/wiki/Super_Bowl_LIII">Spoiler alert</a>.</em></p>

# In[331]:


get_ipython().run_cell_magic('sql', '', "SELECT *\nFROM games\nWHERE team_winner = 'New England Patriots' AND team_loser = 'St. Louis Rams';")


# In[332]:


get_ipython().run_cell_magic('nose', '', '# %%nose needs to be included at the beginning of every @tests cell\n\nlast_output = _\n\ndef test_output():\n    correct_result_string = \'   super_bowl   date_game                venue         city      state  attendance           team_winner  winning_pts qb_winner_1 qb_winner_2    coach_winner      team_loser  losing_pts   qb_loser_1 qb_loser_2 coach_loser  combined_pts  difference_pts\\n0          36  2002-02-03  Louisiana Superdome  New Orleans  Louisiana       72922  New England Patriots           20   Tom Brady        None  Bill Belichick  St. Louis Rams          17  Kurt Warner       None  Mike Martz            37               3\'\n    try:\n        assert last_output.DataFrame().to_string() == correct_result_string\n    except AttributeError:\n        assert False, "Please ensure a SQL ResultSet is the output of the code cell."\n    except AssertionError:\n        assert False, "The results of the query are incorrect. Please review the instructions and check the hint if necessary."')

